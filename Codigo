using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Collections.Generic;
using System.Linq;
using System.Threading;
public class Cliente
{
    public string nombre;
    public Cliente siguiente;
    
}
public class listaligada
{
   public Cliente clientes; 
     public void AgregarCliente()
    {
        Cliente current = clientes;
         if(clientes == null )
         {
             clientes = new Cliente();
            
             clientes.siguiente = null;
             current = clientes;

         }
    }
}
public class SimpleTcpSrvr
{
   
    public static void Main()
    {
        int recv,recv1;
        byte[] data = new byte[1024];
        byte[] data2 = new byte[1024];
        IPEndPoint ipep = new IPEndPoint(IPAddress.Any,
                               1900);

        Socket newsock = new Socket(AddressFamily.InterNetwork,
                        SocketType.Stream, ProtocolType.Tcp);

        newsock.Bind(ipep);
        newsock.Listen(10);
        Console.WriteLine("Esperando por un cliente...");
        Socket client1 = newsock.Accept();
        IPEndPoint clientep1 =
                     (IPEndPoint)client1.RemoteEndPoint;
        Console.WriteLine("Conectado con {0} por el puerto {1}",
                        clientep1.Address, clientep1.Port);
        Socket client2 = newsock.Accept();
        IPEndPoint clientep2 =
                     (IPEndPoint)client2.RemoteEndPoint;
        Console.WriteLine("Conectado con {0} por el puerto {1}",
                        clientep2.Address, clientep2.Port);
        string welcome = "Bienvenido al servidor de prueba";
        data = Encoding.ASCII.GetBytes(welcome);
        client1.Send(data, data.Length,
                          SocketFlags.None);
        client2.Send(data, data.Length,
                          SocketFlags.None);
        while (true)
        {
            data = new byte[1024];
            recv = client1.Receive(data);
            if (recv == 0)
                break;
            Console.WriteLine(
                      Encoding.ASCII.GetString(data, 0, recv));
            client2.Send(data, recv, SocketFlags.None);
            data2 = new byte[1024];
            recv1 = client2.Receive(data2);
            if (recv1 == 0)
                break;
            Console.WriteLine(
                     Encoding.ASCII.GetString(data2, 0, recv1));
            client1.Send(data2, recv1, SocketFlags.None);
           
        }
        Console.WriteLine("Desconectado de {0}",
                          clientep1.Address); 
        Console.WriteLine("Desconectado de {0}",
                           clientep2.Address);
        client1.Close();
        client2.Close();
        newsock.Close();
    }
}
